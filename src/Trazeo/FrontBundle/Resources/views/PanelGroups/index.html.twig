{% set activeMenu = "groups" %}
{% set pageheader_title = "Groups.index.title"|trans %}
{% set pageheader_description = "Groups.index.description"|trans %}
{% extends 'TrazeoFrontBundle:Panel:base.html.twig' %}

       
{% block body_content %}

        <div class="col-lg-12 alert alert-success">
        	<div class="col-md-1">
        		<i class="fa fa-5x fa-users"></i>
        	</div>
        	<div class="col-md-10">
				<h4>Listado de grupos creados en Trazeo</h4>
				<form action="{{ path('panel_group') }}">
					<a class="pull-left" href="{{ path('panel_group_new') }}">
						<button type="button" class="btn btn-success" id="new_group">
							 <i class="fa fa-plus-circle"></i>&nbsp; {{ 'Groups.new.title'|trans }}									
						</button>
					</a>	
				</form>	
			</div>
		
        </div><!-- END col-lg-12 alert alert-info -->
        <p>&nbsp;</p>

        {% for userAdmin in userAdmin %}
	        {% for allGroupsAccess in allGroupsAccess %}
				{% if userAdmin.Id == allGroupsAccess.Group.Id  %}
				<div>
	        		<td><b>{{ allGroupsAccess.Userextend }}</b> pide acceso para unirse al grupo <b>{{ allGroupsAccess.Group }}</b> del que eres administrador
						&nbsp;<a href="{{ path('panel_group_let_join', { 'id': allGroupsAccess.Userextend.Id, 'group':allGroupsAccess.Group.Id }) }}" type="button" class="label label-success">
							<i class="fa fa-check"></i> Aceptar
						</a>&nbsp;
						<a href="{{ path('panel_group_deny_join', { 'id': allGroupsAccess.Userextend.Id , 'group':allGroupsAccess.Group.Id }) }}" type="button" class="label label-danger">
							<i class="fa fa-times"></i> Denegar
						</a>
	        		 </td>
				</div>
				<br />
	        	{% endif %}
	        {% endfor %}
        {% endfor %}
	        {% for allGroupInvite in allGroupsInvite %}
				{% if user.Id == allGroupInvite.Userextend.Id  %}
				<div class="alert alert-default">
	        		<p>Tienes una invitación para unirte al grupo oculto <b>{{ allGroupInvite.Group }}</b>
						&nbsp;<a href="{{ path('panel_group_invite_accept', { 'id': allGroupInvite.Userextend.Id, 'group':allGroupInvite.Group.Id }) }}" type="button" class="label label-success">
							<i class="fa fa-check"></i> Aceptar
						</a>&nbsp;
						<a href="{{ path('panel_group_invite_deny', { 'id': allGroupInvite.Userextend.Id ,'group': allGroupInvite.Group.Id }) }}" type="button" class="label label-danger">
							<i class="fa fa-times"></i> Cancelar
						</a>
	        		 </p>
	        	</div>
	        	{% endif %}
	        {% endfor %}

				<!-- START resumeGroups -->
				<div class="resumeGroups alert alert-warning" id="groups">
					<div>
						<div class="alert alert-warning">
							<table class="table">
								<thead>
									<tr>
										<th>#</th>
										<th>{{ 'Groups.data.name'|trans }}</th>
										<th>{{ 'Groups.data.activity'|trans }}</th>
										<th>{{ 'Groups.data.member'|trans }}</th>
										<th>{{ 'Groups.data.visibility'|trans }}</th>
										<th>{{ 'Groups.data.route'|trans }}</th>
										<th>{{ 'Groups.data.options'|trans }}</th>
									</tr>
								</thead>
							        <tbody>
							        {% for groupMember in groupsMember %}
							            <tr>
							                <td><i class="fa fa-users"></i></td>
							                <td>
							                	{% if groupMember.Admin.Id == user.Id %}
							                		<i rel="tooltip-top" title='{{ 'Admin'|trans }}' class="fa fa-key"></i>&nbsp;
							                	{% endif %}
							                 {{ groupMember.Name }}</td>
											<td><a href="{{ path('panel_group_timeline',{'id': groupMember.id}) }}"><i class="fa fa-comments-o"></i>&nbsp; {{ 'Groups.data.chat'|trans }}</a></td>
											<td>
												<a href="{{ path('panel_group_disjoin', { 'id': groupMember.id }) }}" type="button" 
												class="btn btn-default btn-xs group-disjoin">
													<i class="fa fa-sign-out"></i> {{ 'DisJoin'|trans }}
												</a>
											</td>
											{% if groupMember.Admin.Id == user.Id %}
								                {% if  groupMember.Visibility == 0 %}
								                <td><i rel="tooltip-top" title='{{ 'ChangeVisibility'|trans }}' class="fa fa-unlock btn btn-xs btn-success"
								                groupVisibility="0" changeVisibility="{{ path('panel_group_changeVisibility', { 'id': groupMember.id, 'visibility': "replace" }) }}";
												id="visibility-{{ groupMember.id }}" data-toggle="confirmationChange"></i>&nbsp; {{ 'Groups.visibility.public'|trans }}</td>
								                {% elseif groupMember.Visibility == 1 %}
								                <td><i rel="tooltip-top" title='{{ 'ChangeVisibility'|trans }}' class="fa fa-lock btn btn-xs btn-danger"
								                groupVisibility="1" changeVisibility="{{ path('panel_group_changeVisibility', { 'id': groupMember.id, 'visibility': "replace" }) }}";
												id="visibility-{{ groupMember.id }}" data-toggle="confirmationChange"></i>&nbsp; {{ 'Groups.visibility.private'|trans }}</td>
								                {% elseif groupMember.Visibility == 2 %}
								                <td><i rel="tooltip-top" title='{{ 'ChangeVisibility'|trans }}' class="fa fa-eye-slash btn btn-xs btn-warning"
								                groupVisibility="2" changeVisibility="{{ path('panel_group_changeVisibility', { 'id': groupMember.id, 'visibility': "replace" }) }}";
												id="visibility-{{ groupMember.id }}" data-toggle="confirmationChange"></i>&nbsp; {{ 'Groups.visibility.hidden'|trans }}</td>
								                {% endif %}
								             {% else %}   
								             {% if  groupMember.Visibility == 0 %}
								                <td><i class="fa fa-unlock btn btn-xs btn-success"></i>&nbsp; {{ 'Groups.visibility.public'|trans }}</td>
								                {% elseif groupMember.Visibility == 1 %}
								                <td><i class="fa fa-unlock btn btn-xs btn-danger"></i>&nbsp; {{ 'Groups.visibility.private'|trans }}</td>
								                {% elseif groupMember.Visibility == 2 %}
								                <td><i class="fa fa-unlock btn btn-xs btn-warning"></i>&nbsp; {{ 'Groups.visibility.hidden'|trans }}</td>
								              {% endif %}
							                {% endif %}
							               
							                {% if groupMember.route %}
							                <td><a href="{{ path('panel_route')}}{{ groupMember.Route.Id }}">{{ groupMember.Route.Name }}</a></td>
							                {% else %}
							                <td>{{ 'Groups.noRoute'|trans }}</td>
							                {% endif %}
											{% if groupMember.Admin.Id == user.Id %}
							                <td>
												<a class="btn btn-xs btn-default" href="{{ path('panel_group') }}{{ groupMember.id }}/edit"><i class="fa fa-pencil"></i>&nbsp;  {{ 'Options.edit'|trans }}</a>
												<a class="btn btn-xs btn-default" style="cursor:pointer;" data-href="{{ path('panel_group_delete', {'id': groupMember.id }) }}" data-toggle="confirmation"" data-title='{{ 'Confirmation.question'|trans }}' data-btnCancelLabel='{{ 'Confirmation.no'|trans }}' data-btnOkLabel='{{ 'Confirmation.yes'|trans }}'><i class="fa fa-trash-o"></i>&nbsp; {{ 'Options.delete'|trans }}</a>
							                </td>
							                {% else %}
							                <td>&nbsp;</td>
							                {% endif %}
							            </tr>
							        {% endfor %}
							        
							        {% for restGroup in restGroups %}
							            <tr>
							                <td><i class="fa fa-users"></i></td>
							                <td>
							                {% if restGroup.Admin.Id == user.Id %}
							                	<i rel="tooltip-top" title='{{ 'Admin'|trans }}' class="fa fa-key"></i>&nbsp;
							                {% endif %}
							                 {{ restGroup.Name }}</td>
											<td><i class="fa fa-warning	"></i>&nbsp; {{ 'NoAccess'|trans }}</a></td>
											<td>
												<a href="{{ path('panel_group_join', { 'id': restGroup.id }) }}" type="button" 
												class="btn btn-default btn-xs group-join">
													<i class="fa fa-sign-in"></i> {{ 'Join'|trans }}
												</a> 
											</td>
											{% if restGroup.Admin.Id == user.Id %}
								                {% if  restGroup.Visibility == 0 %}
								                <td><i rel="tooltip-top" title='{{ 'ChangeVisibility'|trans }}' class="fa fa-unlock btn btn-xs btn-success"
								                groupVisibility="0" changeVisibility="{{ path('panel_group_changeVisibility', { 'id': restGroup.id, 'visibility': "replace" }) }}";
												id="visibility-{{ restGroup.id }}" data-toggle="confirmationChange"></i>&nbsp; {{ 'Groups.visibility.public'|trans }}</td>
								                {% elseif restGroup.Visibility == 1 %}
								                <td><i rel="tooltip-top" title='{{ 'ChangeVisibility'|trans }}' class="fa fa-lock btn btn-xs btn-danger"
								                groupVisibility="1" changeVisibility="{{ path('panel_group_changeVisibility', { 'id': restGroup.id, 'visibility': "replace" }) }}";
												id="visibility-{{ restGroup.id }}" data-toggle="confirmationChange"></i>&nbsp; {{ 'Groups.visibility.private'|trans }}</td>
								                {% elseif restGroup.Visibility == 2 %}
								                <td><i rel="tooltip-top" title='{{ 'ChangeVisibility'|trans }}' class="fa fa-eye-slash btn btn-xs btn-warning"
								                groupVisibility="2" changeVisibility="{{ path('panel_group_changeVisibility', { 'id': restGroup.id, 'visibility': "replace" }) }}";
												id="visibility-{{ restGroup.id }}" data-toggle="confirmationChange"></i>&nbsp; {{ 'Groups.visibility.hidden'|trans }}</td>
								                {% endif %}
								             {% else %}   
								             {% if  restGroup.Visibility == 0 %}
								                <td><i class="fa fa-unlock btn btn-xs btn-success"></i>&nbsp; {{ 'Groups.visibility.public'|trans }}</td>
								                {% elseif restGroup.Visibility == 1 %}
								                <td><i class="fa fa-unlock btn btn-xs btn-danger"></i>&nbsp; {{ 'Groups.visibility.private'|trans }}</td>
								                {% elseif restGroup.Visibility == 2 %}
								                <td><i class="fa fa-unlock btn btn-xs btn-warning"></i>&nbsp; {{ 'Groups.visibility.hidden'|trans }}</td>
								              {% endif %}
							                {% endif %}
							               
							                {% if restGroup.route %}
							                <td><a href="{{ path('panel_route')}}{{ restGroup.Route.Id }}">{{ restGroup.Route.Name }}</a></td>
							                {% else %}
							                <td>{{ 'Groups.noRoute'|trans }}</td>
							                {% endif %}
											{% if restGroup.Admin.Id == user.Id %}
							                <td>
												<a class="btn btn-xs btn-default" href="{{ path('panel_group') }}{{ restGroup.id }}/edit"><i class="fa fa-pencil"></i>&nbsp;  {{ 'Options.edit'|trans }}</a>
												<a class="btn btn-xs btn-default" style="cursor:pointer;" data-href="{{ path('panel_group_delete', {'id': restGroup.id }) }}" data-toggle="confirmation"" data-title='{{ 'Confirmation.question'|trans }}' data-btnCancelLabel='{{ 'Confirmation.no'|trans }}' data-btnOkLabel='{{ 'Confirmation.yes'|trans }}'><i class="fa fa-trash-o"></i>&nbsp; {{ 'Options.delete'|trans }}</a>
							                </td>
							                {% else %}
							                <td>&nbsp;</td>
							                {% endif %}
							            </tr>
							        {% endfor %}
							        </tbody>
							</table>
						</div>
					</div>
				</div>

{% endblock %}{# END body_content #}

{% block js %} {{ parent() }} 
	<input type="hidden" id="path_home" value="{{ path('panel_dashboard') }}">

	<script type="text/javascript">
	if(localStorage.getItem('tutorial')=='groups'){
		localStorage.setItem('tutorial','none');
   		var trip = new Trip([
   	                         { 
   	                             sel : $('.panel.panel-warning'),
   	                             content : 'Aqui aparecera la información de las rutas',
   	                             position: 'n'
   	                         },
   	                         { 
   	                             sel : $(".join-admin"),
   	                             content : '???',
   	                             position: 'n'
   	                         },
   	                         { 
   	                             sel : $(".group-timeline"),
   	                             content : 'Aqui podra chatear con el resto de tutores del grupo',
   	                             position: 'n'
   	                         },
   	                         { 
   	                             sel : $(".group-disjoin"),
   	                             content : 'Aqui podra salir de un grupo',
   	                             position: 'n'
   	                         },
   	                         { 
   	                             sel : $(".group-join"),
   	                             content : 'Aqui podra unirse a un grupo',
   	                             position: 'n'
   	                         },
   	                         { 
   	                             sel : $(".group-request-join"),
   	                             content : 'Aqui podra solicitar acesso a un grupo privado',
   	                             position: 'n'
   	                         },
   	                         { 
   	                             sel : $(".group-edit"),
   	                             content : 'Aqui podra editar la información de un grupo',
   	                             position: 'n'
   	                         },  
   	                         { 
   	                             sel : $(".group-visibility"),
   	                             content : 'Aqui podra cambiar la visibilidad del grupo si es administrador del mismo',
   	                             position: 'w',
   	                             callback: function(){
   	                            	localStorage.setItem('tutorial','routes');
                             	 	var url = $('#path_home').attr('value');    
                            	 	window.location.replace(url);
   	   	                         }
   	                         }
   	                         
                      ], {
        					 delay : 2500,
        					 skipUndefinedTrip: true
    				});
		trip.start();
	}
	</script>	
{% endblock %}